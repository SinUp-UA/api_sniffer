name: Release Extension

on:
  push:
    tags:
      - 'v*.*.*'

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: Create Chrome package
        run: |
          cd chrome
          zip -r ../Universal-API-Sniffer-Chrome-v${{ steps.get_version.outputs.VERSION }}.zip .
          cd ..

      - name: Create Firefox package
        run: |
          cd firefox
          zip -r ../Universal-API-Sniffer-Firefox-v${{ steps.get_version.outputs.VERSION }}.xpi .
          cd ..

      - name: Create Chromium-based browsers package
        run: |
          cd chrome
          zip -r ../Universal-API-Sniffer-Chromium-v${{ steps.get_version.outputs.VERSION }}.zip .
          cd ..

      - name: Update updates.xml for Chrome
        run: |
          sed -i "s/version='[0-9.]*'/version='${{ steps.get_version.outputs.VERSION }}'/" updates.xml
          sed -i "s/chrome-v[0-9.]*\//chrome-v${{ steps.get_version.outputs.VERSION }}\//" updates.xml
          sed -i "s/Chrome-v[0-9.]*.zip/Chrome-v${{ steps.get_version.outputs.VERSION }}.zip/" updates.xml

      - name: Update updates.json for Firefox
        run: |
          sed -i "s/\"version\": \"[0-9.]*\"/\"version\": \"${{ steps.get_version.outputs.VERSION }}\"/" updates.json
          sed -i "s/firefox-v[0-9.]*\//firefox-v${{ steps.get_version.outputs.VERSION }}\//" updates.json
          sed -i "s/Firefox-v[0-9.]*.xpi/Firefox-v${{ steps.get_version.outputs.VERSION }}.xpi/" updates.json

      - name: Commit updated files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add updates.xml updates.json
          git commit -m "Update version to ${{ steps.get_version.outputs.VERSION }}" || echo "No changes to commit"
          git push origin HEAD:main || echo "No changes to push"

      - name: Create Chrome Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: chrome-v${{ steps.get_version.outputs.VERSION }}
          name: "Chrome/Edge/Opera/Brave v${{ steps.get_version.outputs.VERSION }}"
          files: Universal-API-Sniffer-Chrome-v${{ steps.get_version.outputs.VERSION }}.zip
          body: |
            ## üåê Universal API Sniffer –¥–ª—è Chrome/Edge/Opera/Brave
            
            **–í–µ—Ä—Å–∏—è**: ${{ steps.get_version.outputs.VERSION }}
            
            ### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
            
            1. –°–∫–∞—á–∞–π—Ç–µ `Universal-API-Sniffer-Chrome-v${{ steps.get_version.outputs.VERSION }}.zip`
            2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É
            3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ:
               - Chrome: `chrome://extensions/`
               - Edge: `edge://extensions/`
               - Opera: `opera://extensions/`
               - Brave: `brave://extensions/`
            4. –í–∫–ª—é—á–∏—Ç–µ **"–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞"**
            5. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"**
            6. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É
            
            ### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
            
            - ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç fetch/XHR/WebSocket/SSE
            - ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON –∏ ZIP (—Å HAR)
            - ‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            - ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub
            
            ### üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            
            –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —á–∞—Å–æ–≤.
            
            ---
            
            ¬© 2025 SinUP Agency | [GitHub](https://github.com/SinUp-UA/api_sniffer)
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Chromium Browsers Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: chromium-v${{ steps.get_version.outputs.VERSION }}
          name: "Edge/Opera/Brave/Vivaldi v${{ steps.get_version.outputs.VERSION }}"
          files: Universal-API-Sniffer-Chromium-v${{ steps.get_version.outputs.VERSION }}.zip
          body: |
            ## üåê Universal API Sniffer –¥–ª—è Edge/Opera/Brave/Vivaldi –∏ –¥—Ä—É–≥–∏—Ö Chromium –±—Ä–∞—É–∑–µ—Ä–æ–≤
            
            **–í–µ—Ä—Å–∏—è**: ${{ steps.get_version.outputs.VERSION }}
            **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã**: Windows, macOS, Linux
            
            ### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
            
            1. –°–∫–∞—á–∞–π—Ç–µ `Universal-API-Sniffer-Chromium-v${{ steps.get_version.outputs.VERSION }}.zip`
            2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–∞–ø–∫—É
            3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
               - **Microsoft Edge**: `edge://extensions/`
               - **Opera**: `opera://extensions/`
               - **Brave**: `brave://extensions/`
               - **Vivaldi**: `vivaldi://extensions/`
               - **–î—Ä—É–≥–∏–µ Chromium –±—Ä–∞—É–∑–µ—Ä—ã**: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –±—Ä–∞—É–∑–µ—Ä–∞
            4. –í–∫–ª—é—á–∏—Ç–µ **"–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞"** (Developer mode)
            5. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"** (Load unpacked)
            6. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É
            
            ### üñ•Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
            
            - ‚úÖ **Windows** 10/11
            - ‚úÖ **macOS** 10.12+
            - ‚úÖ **Linux** (Ubuntu, Fedora, Debian, Arch –∏ –¥—Ä.)
            
            ### üåç –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
            
            - **Microsoft Edge** 88+
            - **Opera** 74+
            - **Brave Browser**
            - **Vivaldi**
            - **Yandex Browser**
            - **Any Chromium-based browser** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Manifest V3
            
            ### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
            
            - ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç **fetch** / **XHR** / **WebSocket** / **SSE**
            - ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ **JSON** –∏ **ZIP** (—Å HAR —Ñ–∞–π–ª–æ–º)
            - ‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            - ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub (–≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞)
            
            ### üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            
            –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 —á–∞—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞).
            
            ### üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
            
            - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –Ω–∞ **–≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö**
            - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –û–°
            - –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
            
            ---
            
            ¬© 2025 SinUP Agency | [GitHub](https://github.com/SinUp-UA/api_sniffer)
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Firefox Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: firefox-v${{ steps.get_version.outputs.VERSION }}
          name: "Firefox v${{ steps.get_version.outputs.VERSION }}"
          files: Universal-API-Sniffer-Firefox-v${{ steps.get_version.outputs.VERSION }}.xpi
          body: |
            ## ü¶ä Universal API Sniffer –¥–ª—è Firefox
            
            **–í–µ—Ä—Å–∏—è**: ${{ steps.get_version.outputs.VERSION }}
            
            ### üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
            
            1. –°–∫–∞—á–∞–π—Ç–µ `Universal-API-Sniffer-Firefox-v${{ steps.get_version.outputs.VERSION }}.xpi`
            2. –û—Ç–∫—Ä–æ–π—Ç–µ Firefox –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ: `about:debugging#/runtime/this-firefox`
            3. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ..."**
            4. –í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `.xpi`
            
            **‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞.
            
            ### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
            
            - ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç fetch/XHR/WebSocket/SSE
            - ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON –∏ ZIP (—Å HAR)
            - ‚úÖ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            - ‚úÖ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ GitHub
            
            ### üîÑ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
            
            –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞.
            
            ---
            
            ¬© 2025 SinUP Agency | [GitHub](https://github.com/SinUp-UA/api_sniffer)
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
